# Kodelua 概述

Kodelua 是为了开发移动游戏，结合使用 cocos2d-x 框架而开发一个轻量级的框架。目的是为了方便进行模块化开发和团队协助开发而写的，其实可以理解为只是定制了一些写代码的规范。同时也提供了一些对 lua 语言的扩展和一些编程常用的工具，如国际化支持，日志，数据处理等。

##　什么是 MVCS？

- M 就是 Model 层，存储数据的地方，只提供2种接口，gets 和 sets 接口。
- V 就是 View 层，界面显示的地方，处理界面的显示并提供 update 接口（提供给 controller 调用）来更新界面。
- C 就是 Controller 层，处理游戏逻辑的地方，她需要与其他所有层打交道，她是总管。
- S 就是 Service 层，负责与服务器端（如果用在客户端，完全可以用在服务器端）交互，只提供2中接口，请求和响应接口。

## 思想比规范更重要

框架虽然是实现了 MVC 的思想，也在规范上做了一些努力，但是其实真正的框架是在我们的脑海中，那是 MVC 的思想，我们在编写代码的时候要有 MVC 的思想更重要，而且只有这样才是真正的实现了 MVC，不然，就是使用了 MVC 框架，你写出来的代码还是一团糟的，根本没有体现 MVC 思想，就相当于给你一把屠龙刀和倚天剑，你去砍柴用了，而且你还会觉得很好用。

## 与 C++ 网络层（network）交互接口

由于我们游戏本身网络层是用 C++ 封装好了，然后在 C++（网络层） 与 lua 之间的交互只提供了非常简单的接口，在 C++ 中只提供了2个接口，一个接口是绑定给 lua 使用的，叫做 RequestServer，在 lua 框架（kodelua）的 service 层就是直接调用这个接口发送请求的；另一个接口就是网络层收到服务器的消息后，调用的接口，这个接口里面就是直接调用 lua 框架的函数 Route，这样交互就设计得非常简单明了。

### Route

这个方法在 app 目录下 init.lua 可以找到，她只接收一个参数，是一个 json 格式的字符串，解码后，通过 action 来反射到 lua 框架中 service 层的对象方法，这样的协议就比较简单，可以做到自动映射，需要维护任何的协议号。

### RequestServer

这个方法是在 C++ 中绑定给 lua 使用的，同样地，她也只接受一个 json 格式的字符串（lua中），在 C++ 中是 char * 类型，这样的接口显得非常简单，而且 json 格式本来就是很好很简单的数据交互格式。

json 的解码和编码都只做了一次，在 Route 调用中是字符串回来的，所以要做一次的解码给 lua 框架要使用，而编码是在 service 层发送请求之前，要将对象编码后作为 RequestService 的参数传递出去。

## 导航
- [目录](00.md)
- 下一章 [Controller 层](02.md)
